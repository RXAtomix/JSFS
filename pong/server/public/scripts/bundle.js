(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var i;t.g.importScripts&&(i=t.g.location+"");var e=t.g.document;if(!i&&e&&(e.currentScript&&(i=e.currentScript.src),!i)){var s=e.getElementsByTagName("script");s.length&&(i=s[s.length-1].src)}if(!i)throw new Error("Automatic publicPath is not supported in this browser");i=i.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=i+"../"})();class i{constructor(t,i,e,s=0,h=0){this.y=i,this.x=t,this.img=new Image,this.img.src=e,this.shiftX=s,this.shiftY=h,this.tempy=i,this.tempx=t,this.tempxSh=this.shiftX,this.tempySh=this.shiftY}get width(){return this.img.width}get height(){return this.img.height}move(){this.x=this.x+this.shiftX,this.y=this.y+this.shiftY}draw(t){t.drawImage(this.img,this.x,this.y)}stopMoving(){this.shiftX=0,this.shiftY=0}replace(t,i){this.y=i,this.x=t,this.shiftX=this.tempxSh,this.shiftY=this.tempySh}}const e=t.p+"images/balle24.png",s=[-3,-2,-1,0,0,1,2,3];class h extends i{constructor(t,i,s){super(t,i,e,-8,-4),this.theGame=s}move(){if(this.y<=0||this.y+this.height>=this.theGame.canvas.height)this.shiftY=-this.shiftY;else if(this.collisionWithPaddleG(this.theGame.getPaddleG())){const t=this.theGame.getPaddleG().get_y(),i=this.theGame.getPaddleG().height/s.length,e=this.y-t+24,h=Math.floor(e/i);this.shiftY+=s[h],this.shiftX-=s[h],this.shiftX=-this.shiftX,this.theGame.collision(this.shiftX,this.shiftY,this.x,this.y)}return super.move(),(this.x<=0||this.x+this.width>=this.theGame.canvas.width)&&(this.shiftX=0,this.shiftY=0,this.x<=0?this.theGame.increase_points_playerD():this.theGame.increase_points_playerG(),this.x=this.tempx,this.y=this.tempy,this.theGame.getPaddleG().x=this.theGame.getPaddleG().tempx,this.theGame.getPaddleG().y=this.theGame.getPaddleG().tempy,!0)}collisionWithPaddleG(t){const i=t.get_x(),e=t.get_y(),s=t.get_y()+t.height;return this.x<=i+t.width&&this.y+this.height>=e&&this.y<=s}change_Sh(t,i,e,s){this.shiftX=-t,this.shiftY=i,this.x=this.theGame.canvas.width-e,this.y=s}}const n=Symbol("UP"),a=Symbol("DOWN"),o=Symbol("LEFT"),r=Symbol("RIGHT");class l{static get UP(){return n}static get DOWN(){return a}static get LEFT(){return o}static get RIGHT(){return r}}const c=t.p+"images/paddle.png";class d extends i{constructor(t,i,e){super(t,i,c,0,5),this.theGame=e,this.moving=null}move(t){"up"==t?this.shiftY=-this.shiftY:"down"==t&&(this.shiftY=+this.shiftY),super.move()}up(){if(l===l.UP)return!0}down(){if(l===l.DOWN)return!0}moveUp(){this.shiftY=-5,this.moving=l.UP}moveDown(){this.shiftY=5,this.moving=l.DOWN}stopMoving(){this.moving=l.NONE}move(t){this.moving===l.UP&&(this.y=Math.max(0,this.y+this.shiftY)),this.moving===l.DOWN&&(this.y=Math.min(t.height-this.height,this.y+this.shiftY))}get_x(){return this.x}get_y(){return this.y}set_y(t){this.y=t}}class m{#t;constructor(t){this.raf=null,this.canvas=t,this.ball=new h(this.canvas.width/2,this.canvas.height/2,this),this.paddleG=new d(10,this.canvas.height/2,this),this.paddleD=new d(this.canvas.width-37,this.canvas.height/2,this),this.poinst_playerG=0,this.poinst_playerD=0,this.begin=!1,this.#t}start(){this.#t=io(),this.#t.connect(),this.change(this.#t),this.#t.emit("ball",this.ball.shiftX,this.ball.shiftY,this.ball.x,this.ball.y),this.#t.on("changeSh",((t,i,e,s)=>{this.ball.change_Sh(t,i,e,s)})),this.#t.on("nb",(()=>{this.#t.on("start",(()=>{this.moveAndDraw()}))})),this.#t.on("replay",(()=>{this.ball=new h(this.canvas.width/2,this.canvas.height/2,this),this.#t.emit("ball",this.ball.shiftX,this.ball.shiftY,this.ball.x,this.ball.y),this.#t.on("changeSh",((t,i,e,s)=>{this.ball.change_Sh(t,i,e,s)})),this.moveAndDraw()}))}stopgame(){window.cancelAnimationFrame(this.raf),this.#t.disconnect(!0)}moveAndDraw(){const t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),this.ball.draw(t);const i=this.ball.move();this.paddleG.draw(t),this.paddleG.move(this.canvas),this.paddleD.draw(t),this.movePaddleD(this.#t),this.#t.emit("move",this.paddleG.get_y()),i?window.cancelAnimationFrame(this.raf):this.raf=window.requestAnimationFrame(this.moveAndDraw.bind(this))}keyDownActionHandler(t){switch(t.key){case"ArrowUp":case"Up":this.paddleG.moveUp(),this.#t.emit("move",this.paddleG.get_y());break;case"ArrowDown":case"Down":this.paddleG.moveDown(),this.#t.emit("move",this.paddleG.get_y());break;case" ":1==this.id&&(this.begin?this.#t.emit("replay"):(this.#t.emit("start"),this.begin=!0));break;default:return}t.preventDefault()}keyUpActionHandler(t){switch(t.key){case"ArrowUp":case"ArrowDown":this.paddleG.stopMoving(),this.#t.emit("move",this.paddleG.get_y());break;default:return}t.preventDefault()}collision(t,i,e,s){this.#t.emit("collision",t,i,e,s)}movePaddleD(t){t.on("move",(t=>{this.paddleD.set_y(t)}))}getPaddleG(){return this.paddleG}getPaddleD(){return this.paddleD}getCanvasWidth(){return this.canvas.height}increase_points_playerG(){this.poinst_playerG++,document.getElementById("score").innerHTML="Your score is "+this.poinst_playerG}increase_points_playerD(){this.poinst_playerD++,document.getElementById("score").innerHTML="Your score is "+this.poinst_playerG}getio(){return this.#t}change(t){t.on("first",(()=>{document.getElementById("start").value="First player (click here to disconnect)",this.id=1})),t.on("second",(()=>{document.getElementById("start").value="Second player (click here to disconnect)",this.id=2})),t.on("no",(()=>{document.getElementById("start").value="Cannot connect"})),t.on("other",(()=>{document.getElementById("start").value="You were disconnected cause your opponnent disconnect (click here to be able to reconnect)",this.stopgame()}))}}window.addEventListener("load",(()=>{const t=document.getElementById("field"),i=new m(t);window.addEventListener("keydown",i.keyDownActionHandler.bind(i)),window.addEventListener("keyup",i.keyUpActionHandler.bind(i)),document.getElementById("start").addEventListener("click",(()=>p(i)))}));let g=!1;const p=t=>{g?(document.getElementById("start").value="Connect",t.stopgame(),t.begin=!1):t.start(),g=!g}})();